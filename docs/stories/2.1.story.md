# Story: 2.1 - Context & Components

## Status: Done

## Dev Agent Record

### Agent Model Used

Gemini

### Debug Log References

- Reviewed architecture.md and confirmed it meets story requirements.

### Completion Notes List

- Story 2.1 involved reviewing the existing architecture documentation regarding context and components. No code changes were required as the documentation was found to be clear, concise, and complete as per the acceptance criteria.

### File List

- docs/architecture.md (reviewed)

### Change Log

- 2025-08-02: Completed review of context and components documentation. Marked tasks as complete and story as 'Done'.

## Story

As a developer, I want to understand the system's context and its components so that I can build and maintain the application effectively.

## Acceptance Criteria

1.  The documentation clearly defines the system's components.
2.  The documentation provides a clear diagram of the system's context.
3.  The documentation describes the responsibilities of each component.

## Dev Notes

### Previous Story Insights

- The system is a single Streamlit application with all components running in-process. [Source: docs/stories/1.1.story.md]

### Data Models

No specific guidance found in architecture docs.

### API Specifications

No specific guidance found in architecture docs.

### Component Specifications

- **Streamlit App**: Single-page application that hosts both user and admin interfaces; leverages Streamlit callbacks to invoke services directly. [Source: docs/architecture.md#2-context--components]
- **Form Service**: On startup, loads a fixed JSON schema parsed from `SEZNAM POTREBNIH_PODATKOV.docx`. Renders a static form with predetermined fields. Manages draft save/retrieve operations through SQLite. [Source: docs/architecture.md#2-context--components]
- **Template Admin Service**: Administrator-only module for managing Word templates and database operations. Parses `.docx` templates via `python-docx` and exposes controls to view/overwrite templates, clear or back up SQLite drafts, and manage ChromaDB collections. [Source: docs/architecture.md#2-context--components]
- **Semantic Retrieval Service**: Generates embeddings for historical contracts and stores them in ChromaDB. Provides a function to retrieve top-k similar contract snippets for prompt enrichment. [Source: docs/architecture.md#2-context--components]
- **AI Generation Service**: Composes prompts using a fixed system prompt, user form data, and retrieved context, and calls the LLM (via OpenAI) to generate narrative text. [Source: docs/architecture.md#2-context--components]
- **Document Assembly Service**: Uses `python-docx` to merge field values and AI-generated narratives into template documents and then packages them into a ZIP in-memory. [Source: docs/architecture.md#2-context--components]
- **Download Module**: Utilizes Streamlitâ€™s `st.download_button` to serve the generated ZIP to end users for direct download. [Source: docs/architecture.md#2-context--components]
- **SQLite (Drafts)**: Persists user draft data (JSON blobs) for retrieval across sessions. [Source: docs/architecture.md#2-context--components]
- **ChromaDB**: Stores vector embeddings for semantic search of past contracts. [Source: docs/architecture.md#2-context--components]

### File Locations

No specific guidance found in architecture docs.

### Testing Requirements

- **Unit Tests**: Each service should have unit tests to verify its functionality in isolation.
- **Integration Tests**: Integration tests should be written to verify that the services work together as expected.
- **End-to-End Tests**: End-to-end tests should be written to verify that the entire system works as expected from the user's perspective.

### Technical Constraints

- All components run in-process within a single Streamlit app. [Source: docs/architecture.md#1-architecture-overview]

## Tasks / Subtasks

- [x] **Task 1 (AC: 1, 2, 3):** Review the context and components documentation to ensure it is clear, concise, and complete.
    - [x] Subtask 1.1: Verify that the documentation accurately reflects the current state of the system.
    - [x] Subtask 1.2: Identify any areas of the documentation that are unclear or could be improved.
    - [x] Subtask 1.3: Make any necessary updates to the documentation.
